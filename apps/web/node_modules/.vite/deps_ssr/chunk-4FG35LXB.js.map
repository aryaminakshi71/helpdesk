{
  "version": 3,
  "sources": ["../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/access/access.ts", "../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/two-factor/client.ts", "../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/admin/access/statement.ts", "../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/admin/has-permission.ts", "../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/organization/access/statement.ts", "../../../../../node_modules/.bun/better-auth@1.4.14+d8d708348641e738/node_modules/better-auth/src/plugins/organization/permission.ts"],
  "sourcesContent": ["import { BetterAuthError } from \"@better-auth/core/error\";\nimport type { Statements, Subset } from \"./types\";\n\nexport type AuthorizeResponse =\n\t| { success: false; error: string }\n\t| { success: true; error?: never | undefined };\n\nexport function role<TStatements extends Statements>(statements: TStatements) {\n\treturn {\n\t\tauthorize<K extends keyof TStatements>(\n\t\t\trequest: {\n\t\t\t\t[key in K]?:\n\t\t\t\t\t| TStatements[key]\n\t\t\t\t\t| {\n\t\t\t\t\t\t\tactions: TStatements[key];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t  };\n\t\t\t},\n\t\t\tconnector: \"OR\" | \"AND\" = \"AND\",\n\t\t): AuthorizeResponse {\n\t\t\tlet success = false;\n\t\t\tfor (const [requestedResource, requestedActions] of Object.entries(\n\t\t\t\trequest,\n\t\t\t)) {\n\t\t\t\tconst allowedActions = statements[requestedResource];\n\t\t\t\tif (!allowedActions) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `You are not allowed to access resource: ${requestedResource}`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(requestedActions)) {\n\t\t\t\t\tsuccess = (requestedActions as string[]).every((requestedAction) =>\n\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof requestedActions === \"object\") {\n\t\t\t\t\t\tconst actions = requestedActions as {\n\t\t\t\t\t\t\tactions: string[];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (actions.connector === \"OR\") {\n\t\t\t\t\t\t\tsuccess = actions.actions.some((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsuccess = actions.actions.every((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new BetterAuthError(\"Invalid access control request\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (success && connector === \"OR\") {\n\t\t\t\t\treturn { success };\n\t\t\t\t}\n\t\t\t\tif (!success && connector === \"AND\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `unauthorized to access resource \"${requestedResource}\"`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (success) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authorized\",\n\t\t\t};\n\t\t},\n\t\tstatements,\n\t};\n}\n\nexport function createAccessControl<const TStatements extends Statements>(\n\ts: TStatements,\n) {\n\treturn {\n\t\tnewRole<K extends keyof TStatements>(statements: Subset<K, TStatements>) {\n\t\t\treturn role<Subset<K, TStatements>>(statements);\n\t\t},\n\t\tstatements: s,\n\t};\n}\n", "import type { BetterAuthClientPlugin } from \"@better-auth/core\";\nimport type { twoFactor as twoFa } from \".\";\n\nexport const twoFactorClient = (\n\toptions?:\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * a redirect function to call if a user needs to verify\n\t\t\t\t * their two factor\n\t\t\t\t */\n\t\t\t\tonTwoFactorRedirect?: () => void | Promise<void>;\n\t\t  }\n\t\t| undefined,\n) => {\n\treturn {\n\t\tid: \"two-factor\",\n\t\t$InferServerPlugin: {} as ReturnType<typeof twoFa>,\n\t\tatomListeners: [\n\t\t\t{\n\t\t\t\tmatcher: (path) => path.startsWith(\"/two-factor/\"),\n\t\t\t\tsignal: \"$sessionSignal\",\n\t\t\t},\n\t\t],\n\t\tpathMethods: {\n\t\t\t\"/two-factor/disable\": \"POST\",\n\t\t\t\"/two-factor/enable\": \"POST\",\n\t\t\t\"/two-factor/send-otp\": \"POST\",\n\t\t\t\"/two-factor/generate-backup-codes\": \"POST\",\n\t\t\t\"/two-factor/get-totp-uri\": \"POST\",\n\t\t\t\"/two-factor/verify-totp\": \"POST\",\n\t\t\t\"/two-factor/verify-otp\": \"POST\",\n\t\t\t\"/two-factor/verify-backup-code\": \"POST\",\n\t\t},\n\t\tfetchPlugins: [\n\t\t\t{\n\t\t\t\tid: \"two-factor\",\n\t\t\t\tname: \"two-factor\",\n\t\t\t\thooks: {\n\t\t\t\t\tasync onSuccess(context) {\n\t\t\t\t\t\tif (context.data?.twoFactorRedirect) {\n\t\t\t\t\t\t\tif (options?.onTwoFactorRedirect) {\n\t\t\t\t\t\t\t\tawait options.onTwoFactorRedirect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t} satisfies BetterAuthClientPlugin;\n};\n\nexport type * from \"./backup-codes\";\nexport type * from \"./otp\";\nexport type * from \"./totp\";\nexport type * from \"./types\";\n", "import { createAccessControl } from \"../../access\";\n\nexport const defaultStatements = {\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\",\n\t],\n\tsession: [\"list\", \"revoke\", \"delete\"],\n} as const;\n\nexport const defaultAc = createAccessControl(defaultStatements);\n\nexport const adminAc = defaultAc.newRole({\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\",\n\t],\n\tsession: [\"list\", \"revoke\", \"delete\"],\n});\n\nexport const userAc = defaultAc.newRole({\n\tuser: [],\n\tsession: [],\n});\n\nexport const defaultRoles = {\n\tadmin: adminAc,\n\tuser: userAc,\n};\n", "import { defaultRoles } from \"./access\";\nimport type { AdminOptions } from \"./types\";\n\ntype PermissionExclusive =\n\t| {\n\t\t\t/**\n\t\t\t * @deprecated Use `permissions` instead\n\t\t\t */\n\t\t\tpermission: { [key: string]: string[] };\n\t\t\tpermissions?: never | undefined;\n\t  }\n\t| {\n\t\t\tpermissions: { [key: string]: string[] };\n\t\t\tpermission?: never | undefined;\n\t  };\n\nexport const hasPermission = (\n\tinput: {\n\t\tuserId?: string | undefined;\n\t\trole?: string | undefined;\n\t\toptions?: AdminOptions | undefined;\n\t} & PermissionExclusive,\n) => {\n\tif (input.userId && input.options?.adminUserIds?.includes(input.userId)) {\n\t\treturn true;\n\t}\n\tif (!input.permissions && !input.permission) {\n\t\treturn false;\n\t}\n\tconst roles = (input.role || input.options?.defaultRole || \"user\").split(\",\");\n\tconst acRoles = input.options?.roles || defaultRoles;\n\tfor (const role of roles) {\n\t\tconst _role = acRoles[role as keyof typeof acRoles];\n\t\tconst result = _role?.authorize(input.permission ?? input.permissions);\n\t\tif (result?.success) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n", "import { createAccessControl } from \"../../access\";\n\nexport const defaultStatements = {\n\torganization: [\"update\", \"delete\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n} as const;\n\nexport const defaultAc = createAccessControl(defaultStatements);\n\nexport const adminAc = defaultAc.newRole({\n\torganization: [\"update\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n});\n\nexport const ownerAc = defaultAc.newRole({\n\torganization: [\"update\", \"delete\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n});\n\nexport const memberAc = defaultAc.newRole({\n\torganization: [],\n\tmember: [],\n\tinvitation: [],\n\tteam: [],\n\tac: [\"read\"], // Allow members to see all roles for their org.\n});\n\nexport const defaultRoles = {\n\tadmin: adminAc,\n\towner: ownerAc,\n\tmember: memberAc,\n};\n", "import type { Role } from \"../access\";\nimport type { OrganizationOptions } from \"./types\";\n\nexport const hasPermissionFn = (\n\tinput: HasPermissionBaseInput,\n\tacRoles: {\n\t\t[x: string]: Role<any> | undefined;\n\t},\n) => {\n\tif (!input.permissions && !input.permission) return false;\n\n\tconst roles = input.role.split(\",\");\n\tconst creatorRole = input.options.creatorRole || \"owner\";\n\tconst isCreator = roles.includes(creatorRole);\n\n\tconst allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;\n\tif (isCreator && allowCreatorsAllPermissions) return true;\n\n\tfor (const role of roles) {\n\t\tconst _role = acRoles[role as keyof typeof acRoles];\n\t\tconst result = _role?.authorize(input.permissions ?? input.permission);\n\t\tif (result?.success) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nexport type PermissionExclusive =\n\t| {\n\t\t\t/**\n\t\t\t * @deprecated Use `permissions` instead\n\t\t\t */\n\t\t\tpermission: { [key: string]: string[] };\n\t\t\tpermissions?: never | undefined;\n\t  }\n\t| {\n\t\t\tpermissions: { [key: string]: string[] };\n\t\t\tpermission?: never | undefined;\n\t  };\n\nexport const cacheAllRoles = new Map<\n\tstring,\n\t{\n\t\t[x: string]: Role<any> | undefined;\n\t}\n>();\n\nexport type HasPermissionBaseInput = {\n\trole: string;\n\toptions: OrganizationOptions;\n\tallowCreatorAllPermissions?: boolean | undefined;\n} & PermissionExclusive;\n"],
  "mappings": "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",
  "names": ["role", "defaultStatements", "defaultAc", "adminAc", "defaultRoles", "role"]
}
